## æ•°æ®åŒæ­¥æ—¶æ²¡æœ‰è‡ªå¢žé”®å’Œæ—¶é—´æˆ³ï¼Œåº”è¯¥æ€Žä¹ˆåŒæ­¥

è¿™æ˜¯**æ•°æ®åŒæ­¥ / æ•°æ®å¹³å° / æž¶æž„é¢è¯•çš„ç»å…¸éš¾é¢˜**ï¼Œæ ¸å¿ƒåœ¨äºŽï¼š**æ²¡æœ‰å¤©ç„¶é¡ºåºå­—æ®µï¼Œæ€Žä¹ˆä¿è¯ä¸æ¼ã€ä¸é‡ã€å¯è¿½æº¯**ã€‚ä¸‹é¢ç»™ä½ ä¸€å¥—**å·¥ç¨‹å¯è½åœ°**çš„å›žç­”ã€‚

------

## é¢è¯•æ€»ç»“ä¸€å¥è¯

> **å½“æ•°æ®æ²¡æœ‰è‡ªå¢žé”®å’Œæ—¶é—´æˆ³æ—¶ï¼ŒåŒæ­¥çš„æ ¸å¿ƒæ˜¯æž„é€ å˜åŒ–æ ‡è¯†ï¼Œå¸¸è§æ–¹æ¡ˆåŒ…æ‹¬ä¸šåŠ¡å”¯ä¸€é”® + hashã€å…¨é‡å¹‚ç­‰åŒæ­¥ï¼Œä»¥åŠåŸºäºŽ Binlog çš„ CDCï¼ŒåŒæ­¥è¿‡ç¨‹ä¸­é€šè¿‡åŽ»é‡å’Œå¯¹è´¦ä¿è¯ä¸€è‡´æ€§ã€‚**

## ä¸€ã€å…ˆç»™ç»“è®ºï¼ˆé¢è¯•å®˜æœ€æƒ³å¬ï¼‰

> **æ²¡æœ‰è‡ªå¢ž IDã€æ²¡æœ‰æ—¶é—´æˆ³çš„æ•°æ®åŒæ­¥ï¼Œæœ¬è´¨è¦äººä¸ºæž„é€ â€œå˜åŒ–æ ‡è¯†â€ï¼Œé€šè¿‡å…¨é‡ + å¯¹è´¦ + å¹‚ç­‰æ¥ä¿è¯ä¸€è‡´æ€§ã€‚**

------

## äºŒã€å¸¸è§å¯è¡Œæ–¹æ¡ˆï¼ˆæŒ‰æŽ¨èç¨‹åº¦ï¼‰

### âœ… æ–¹æ¡ˆä¸€ï¼šä¸šåŠ¡å”¯ä¸€é”® + Hash å¯¹æ¯”ï¼ˆæœ€å¸¸ç”¨ â­ï¼‰

### æ€è·¯

- æ‰¾ **ä¸šåŠ¡å”¯ä¸€é”®**ï¼ˆå¦‚ï¼šè®¢å•å·ã€ç”¨æˆ·å· + ç±»åž‹ï¼‰
- å¯¹éžä¸»é”®å­—æ®µè®¡ç®— **hash / checksum**
- åŒæ­¥æ—¶ï¼š
  - key ç›¸åŒ & hash ä¸åŒ â†’ æ›´æ–°
  - key ä¸å­˜åœ¨ â†’ æ’å…¥

### ç¤ºä¾‹

```
biz_id | name | amount | hash
```

### ä¼˜ç‚¹

- ä¸ä¾èµ–æ—¶é—´
- ç²¾å‡†åˆ¤æ–­æ˜¯å¦å˜åŒ–

### ç¼ºç‚¹

- éœ€è¦ç®— hash
- å¤§è¡¨è¦åˆ†é¡µ

ðŸ“Œ é¢è¯•æ€»ç»“ï¼š

> **é€šè¿‡ä¸šåŠ¡å”¯ä¸€é”® + å†…å®¹ hash æž„é€ å˜åŒ–æ ‡è¯†ï¼Œå®žçŽ°å¢žé‡åŒæ­¥**

------

### âœ… æ–¹æ¡ˆäºŒï¼šå…¨é‡åŒæ­¥ + å¹‚ç­‰è¦†ç›–ï¼ˆå…œåº•æ–¹æ¡ˆï¼‰

### æ€è·¯

- å®šæœŸå…¨è¡¨æ‰«
- ç›®æ ‡è¡¨ `insert or replace / merge`
- ä¿è¯å¹‚ç­‰

### é€‚ç”¨åœºæ™¯

- è¡¨ä¸å¤§
- å¯¹å®žæ—¶æ€§è¦æ±‚ä¸é«˜

### é£Žé™©

- IO åŽ‹åŠ›å¤§
- åŒæ­¥çª—å£é•¿

ðŸ“Œ é¢è¯•å®˜è®¤å¯ç‚¹ï¼š

> **å½“æ— æ³•åˆ¤æ–­å˜åŒ–æ—¶ï¼Œå®å¯å…¨é‡ + å¹‚ç­‰**

------

### âœ… æ–¹æ¡ˆä¸‰ï¼šç‰ˆæœ¬å·ï¼ˆä¹è§‚é”æ€æƒ³ï¼‰

### æ€è·¯

- å¢žåŠ  `version` å­—æ®µ
- æ¯æ¬¡å˜æ›´ version++

```
where biz_id = ? and version > last_version
```

### ä¼˜ç‚¹

- å¤©ç„¶å¢žé‡
- ç²¾å‡†

### å‰æ

- èƒ½æ”¹è¡¨ç»“æž„

------

### âœ… æ–¹æ¡ˆå››ï¼šCDC / Binlog åŒæ­¥ï¼ˆå¼ºçƒˆæŽ¨è â­ï¼‰

### æ€è·¯

- é€šè¿‡ **MySQL Binlog**
- ä¸ä¾èµ–ä¸šåŠ¡å­—æ®µ
- æ•èŽ·çœŸå®žå˜æ›´

### å·¥å…·

- Canal
- Debezium
- Flink CDC

### ä¼˜ç‚¹

- å®žæ—¶
- ä¸æ¼ã€ä¸é‡

### å‰æ

- æºåº“æ”¯æŒ binlog
- æž¶æž„å¤æ‚åº¦é«˜

ðŸ“Œ é¢è¯•åŠ åˆ†ï¼š

> **çœŸæ­£å·¥ä¸šçº§åŒæ­¥é  CDCï¼Œè€Œä¸æ˜¯å­—æ®µå¯¹æ¯”**

------

## âŒ ä¸æŽ¨èæ–¹æ¡ˆï¼ˆé¢è¯•é¿å‘ï¼‰

| æ–¹æ¡ˆ                  | åŽŸå›        |
| --------------------- | ---------- |
| ç‰©ç†è¡Œå·              | ä¸ç¨³å®š     |
| order by æ— å­—æ®µ       | ä¸å¯æŽ§     |
| last_update_time çŒœæµ‹ | æœ¬é¢˜å·²å¦å®š |

------

## ä¸‰ã€å¦‚ä½•é˜²æ­¢â€œæ¼ / é‡ / ä¹±â€ï¼ˆé¢è¯•å®˜æœ€çˆ±è¿½é—®ï¼‰

### 1ï¸âƒ£ åŽ»é‡

- ç›®æ ‡è¡¨å”¯ä¸€ç´¢å¼•
- UPSERT

### 2ï¸âƒ£ å¯¹è´¦

- è¡Œæ•°
- checksum
- åˆ†åŒºæ ¡éªŒ

### 3ï¸âƒ£ å¯å›žæ”¾

- åŒæ­¥ offset
- åŒæ­¥æ—¥å¿—è¡¨

------

## å››ã€ä¸åŒè§„æ¨¡ä¸‹çš„æŽ¨èæ–¹æ¡ˆ

| æ•°æ®é‡ | æŽ¨è          |
| ------ | ------------- |
| å°è¡¨   | å…¨é‡ + å¹‚ç­‰   |
| ä¸­ç­‰   | ä¸šåŠ¡é”® + hash |
| å¤§è¡¨   | CDC / Binlog  |
| å¼ºå®žæ—¶ | Flink CDC     |

------

> 