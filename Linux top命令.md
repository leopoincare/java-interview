## Linux top命令

你这个应该是想问 **「Linux top 命令」**（常见面试 & 线上排查必会）。我按 **是什么 → 常用字段 → 常用快捷键 → 实战用法 → 面试一句话** 给你一版**速查 + 面试版答案**。

## 面试总结一句话

> **top 是 Linux 下实时监控系统资源的工具，常用于排查 CPU 和内存问题，通过观察负载、CPU 使用率和进程占用，快速定位异常进程。**

------

## 一、top 是什么？

> **top 是 Linux 下实时查看系统资源使用情况的命令，主要用于观察 CPU、内存、进程运行状态。**

常用于：

- CPU 飙高排查
- 内存泄漏排查
- 找“吃资源”的进程

------

## 二、top 输出信息怎么看（重点 ⭐）

### 1️⃣ 系统整体信息（第一行）

```
top - 21:30:01 up 10 days,  2 users,  load average: 1.23, 0.95, 0.88
```

| 字段         | 含义                |
| ------------ | ------------------- |
| up           | 运行时长            |
| users        | 当前登录用户        |
| load average | 1 / 5 / 15 分钟负载 |

📌 面试点：

> **Load Average ≈ 运行队列长度**

------

### 2️⃣ CPU 使用率（%Cpu(s)）

```
%Cpu(s): 30.1 us, 5.0 sy, 0.0 ni, 64.0 id, 0.5 wa
```

| 字段 | 含义    |
| ---- | ------- |
| us   | 用户态  |
| sy   | 内核态  |
| id   | 空闲    |
| wa   | IO 等待 |

📌 经验：

- **us 高**：业务代码问题
- **sy 高**：系统调用 / 锁
- **wa 高**：磁盘 / IO 瓶颈

------

### 3️⃣ 内存信息

```
MiB Mem : 16000 total, 12000 used, 4000 free
MiB Swap: 2048 total, 100 used
```

重点：

- free 小 ≠ 内存不足
- 看 **available**

------

### 4️⃣ 进程列表（最重要）

| 列      | 含义         |
| ------- | ------------ |
| PID     | 进程号       |
| %CPU    | CPU 占用     |
| %MEM    | 内存占用     |
| RES     | 实际使用内存 |
| VIRT    | 虚拟内存     |
| COMMAND | 命令         |

------

## 三、top 常用快捷键（必会 ⭐）

| 快捷键 | 作用         |
| ------ | ------------ |
| P      | 按 CPU 排序  |
| M      | 按内存排序   |
| H      | 显示线程     |
| 1      | 显示每核 CPU |
| k      | kill 进程    |
| q      | 退出         |

📌 **线上排查必用组合**：

```
top → P → H
```

------

## 四、结合 Java 排查 CPU 飙高（实战 ⭐）

### 1️⃣ 找进程

```
top
```

### 2️⃣ 看线程

```
top -Hp pid
```

### 3️⃣ 转 16 进制

```
printf "%x\n" tid
```

### 4️⃣ jstack 定位

```
jstack pid | grep tid -A 20
```

👉 定位死循环 / 锁竞争 / GC

------

## 五、top 常见误区（面试加分）

❌ **free 很小就是内存不足**
 ✅ Linux 会用内存做 cache

❌ **load 高就是 CPU 高**
 ✅ 可能是 IO 等待

------

## 六、top 常用参数

```
top -p pid        # 只看某个进程
top -u user       # 看某个用户
top -d 1          # 1 秒刷新
```

