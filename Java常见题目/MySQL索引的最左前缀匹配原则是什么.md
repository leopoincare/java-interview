## MySQL 索引的最左前缀匹配原则是什么？

**最左前缀匹配原则**是 MySQL（主要是 **InnoDB 的 B+Tree 索引**）中非常核心、也是面试高频的概念。下面用**通俗 + 面试友好**的方式说明。

## 面试一句话总结

> **最左前缀匹配原则指的是联合索引在 B+Tree 中按最左列开始排序，查询条件必须从最左列连续匹配，遇到范围查询或跳列时，索引匹配会停止。**

------

## 一、什么是最左前缀匹配原则？

> **使用联合索引时，查询条件必须从索引的最左列开始，并且不能跳过中间列，否则索引无法被充分利用。**

假设有联合索引：

```
INDEX idx_abc (a, b, c)
```

### 能命中索引的情况

```
WHERE a = 1
WHERE a = 1 AND b = 2
WHERE a = 1 AND b = 2 AND c = 3
```

### 不能命中（或只能部分命中）的情况

```
WHERE b = 2
WHERE c = 3
WHERE a = 1 AND c = 3   -- 只能用到 a
```

------

## 二、为什么有这个原则？（底层原因）

### 1️⃣ B+Tree 索引的存储顺序

联合索引在 B+Tree 中的排序方式是：

```
先按 a 排序 → a 相同再按 b → b 相同再按 c
```

类似字典顺序：

```
(a1, b1, c1)
(a1, b1, c2)
(a1, b2, c1)
(a2, b1, c1)
```

👉 **只有从最左列开始，才能快速定位范围**

------

## 三、等值查询 vs 范围查询 ⭐重点

### 1️⃣ 等值查询（= / IN）

```
WHERE a = 1 AND b = 2 AND c = 3
```

- 可以一直向右匹配
- 索引可用到 c

------

### 2️⃣ 范围查询（> < BETWEEN LIKE 'x%'）

```
WHERE a = 1 AND b > 2 AND c = 3
```

- 索引使用到 **b**
- **c 无法继续使用索引**

📌 规则总结：

> **遇到范围查询，索引匹配会在该列终止**

------

## 四、LIKE 查询的特殊情况

### 能用索引

```
WHERE name LIKE 'abc%'
```

### 不能用索引

```
WHERE name LIKE '%abc'
WHERE name LIKE '%abc%'
```

原因：

- 前缀 `%` 导致无法从最左定位

------

## 五、索引列顺序为什么很重要？

### 错误设计

```
INDEX (create_time, user_id)
WHERE user_id = 1001
```

❌ 索引无法使用

------

### 正确设计（高频条件在前）

```
INDEX (user_id, create_time)
```

✅ 命中索引

------

## 六、最左前缀 ≠ 必须按顺序写 SQL

以下 **可以使用索引**：

```
WHERE b = 2 AND a = 1
```

👉 MySQL 优化器会自动调整条件顺序
 ⚠️ 但**前提是没有跳列**

------

## 七、最左前缀原则总结（速记版）

1️⃣ 联合索引必须从最左列开始
 2️⃣ 不能跳过中间列
 3️⃣ 等值可一直向右
 4️⃣ 范围查询会终止
 5️⃣ LIKE 只有前缀匹配才行

