## 什么是服务熔断

这是 **微服务 / 分布式系统必考概念**，面试官主要想考你对 **服务调用稳定性与容错机制** 的理解。下面我给你整理成 **定义 → 原理 → 场景 → 面试一句话** 的结构。

------

## 面试总结一句话

> **服务熔断是一种保护机制，当远程服务异常或响应过慢时，自动中断调用以防止问题蔓延，保证系统整体可用性。**

------

## 一、服务熔断定义

> **服务熔断是一种保护机制，当服务调用异常或响应过慢达到阈值时，自动中断对该服务的请求，避免问题蔓延，保证系统整体可用性。**

- 类似 **电路中的保险丝**，故名 **“熔断”**
- 核心目的是 **防止级联失败**

------

## 二、服务熔断的原理（以 Hystrix / Resilience4j 为例）

### 核心组件

1. **监控统计**
   - 成功率、异常率、响应时间等指标
2. **阈值判断**
   - 连续失败次数或错误率超过阈值
3. **状态机**
   - **关闭（Closed）**：正常调用
   - **开启（Open）**：直接返回失败 / 降级
   - **半开（Half-Open）**：尝试放行少量请求，检测服务恢复

### 流程示例

```
Closed -> Open:
  连续失败次数 > 阈值 -> 断开调用
Open -> Half-Open:
  等待时间到 -> 放行少量请求测试
Half-Open -> Closed:
  测试成功 -> 恢复调用
Half-Open -> Open:
  测试失败 -> 继续断开
```

------

## 三、典型使用场景

1. **依赖第三方服务异常**
   - API 调用超时或错误率高
   - 防止调用堆积导致线程耗尽
2. **微服务内部调用**
   - 服务 B 异常 → 服务 A 继续处理自己请求
   - 避免连锁雪崩
3. **高峰流量保护**
   - 访问量激增 → 快速断开部分非核心服务

------

## 四、与降级的关系

- **熔断**：停止调用异常服务
- **降级**：调用异常服务时返回默认值或备用逻辑

📌 一般结合使用：**先降级，达到阈值再熔断

## 面试官可能追问

- ❓ 熔断和限流有什么区别？
- ❓ 熔断阈值如何设置？
- ❓ 熔断和重试如何配合？
- ❓ 半开状态为什么必要？

下面给你整理一套 **服务熔断追问的标准答案**，按 **问题 → 原理 → 面试一句话** 的方式总结，方便面试时快速回答。

------

## 1️⃣ 熔断和限流有什么区别？

| 维度     | 熔断                       | 限流                     |
| -------- | -------------------------- | ------------------------ |
| 目的     | 保护异常服务，防止级联故障 | 控制请求量，防止系统过载 |
| 触发条件 | 服务错误率高 / 响应慢      | 请求频率超过阈值         |
| 应对策略 | 直接拒绝调用或返回降级     | 延迟、排队或拒绝请求     |
| 关注点   | 服务可靠性                 | 系统稳定性               |

### 面试一句话

> **熔断保护异常服务防止雪崩，限流控制请求量防止系统过载，两者关注点不同但可配合使用。**

------

## 2️⃣ 熔断阈值如何设置？

常见指标：

1. **错误率阈值**
   - 比如连续 20 次失败或 50% 错误率触发
2. **响应时间阈值**
   - 平均或百分位响应超时触发
3. **最小请求数**
   - 避免请求太少就误判
4. **熔断时间窗口**
   - Open 状态持续多长时间后尝试半开

📌 一般根据 **服务业务重要性 + 历史数据 + SLA** 调整

### 面试一句话

> **熔断阈值通常根据错误率、响应时间和请求量设置，确保在服务异常时及时触发熔断，同时避免误判。**

------

## 3️⃣ 熔断和重试如何配合？

- **直接重试 + 熔断 = 危险**
  - 重试会增加异常服务压力 → 雪崩
- **推荐策略**
  1. **先熔断**，避免继续调用异常服务
  2. **半开状态**尝试少量请求
  3. **必要时对短时间失败使用指数退避重试**

### 面试一句话

> **熔断与重试要结合指数退避策略，避免重试放大异常服务压力。**

------

## 4️⃣ 半开状态为什么必要？

- Open 状态后，不可能永久断开
- 半开状态允许 **少量请求测试服务是否恢复**
- 避免服务恢复后仍然熔断，保证系统可用性

### 面试一句话

> **半开状态是熔断的自我恢复机制，用于检测异常服务是否恢复，从而安全地恢复调用。**

------

## 🧠 四问速记版（面试背诵版）

> 1. 熔断保护异常服务，限流控制请求量
> 2. 阈值根据错误率、响应时间和请求量设置
> 3. 熔断+重试结合指数退避，避免雪崩
> 4. 半开状态检测服务恢复，安全恢复调用