## nacos和eureka在CAP 中的偏重情况

这是 **注册中心面试的高频 CAP 题**，关键不是背结论，而是说明 **为什么这么选、带来的取舍是什么**。

## 面试总结一句话

> **在 CAP 定理中，Eureka 选择 AP，优先保证高可用，允许短暂不一致；Nacos 默认选择 AP，支持CP模式，通过 Raft 保证强一致性，在网络分区时可能牺牲可用性，但也支持在部分场景下切换为 AP。**
>
> Eureka 采用客户端定时拉取的 Pull 模式，服务变更感知有延迟；而 Nacos 采用长轮询的 Push + Pull 机制，能够在保证 AP 的同时实现更实时的服务变更推送。

------

## 一、CAP 定理快速回顾（30 秒版）

- **C（Consistency，一致性）**：所有节点看到的数据一致
- **A（Availability，可用性）**：每个请求都能得到响应
- **P（Partition tolerance，分区容错）**：网络分区仍能继续工作

👉 **分布式系统必须支持 P，只能在 C 和 A 之间取舍**

------

## 二、Eureka 在 CAP 中的偏重

### ✅ Eureka：**AP（高可用 + 分区容错）**

#### 设计取向

- **优先保证可用性**
- 允许短时间数据不一致
- 网络分区时：
  - 各节点仍然对外提供服务
  - 可能返回“过期的服务实例”

#### 关键机制

- **自我保护机制**
  - 心跳失败比例过高时，不再剔除实例
- 客户端缓存注册表
- 去中心化（无强 Leader）

#### 适用场景

- 微服务数量大
- 对“短暂访问到旧实例”容忍度高
- 服务可重试、快速失败

📌 一句话：

> **Eureka 宁可返回旧数据，也不拒绝请求**

------

## 三、Nacos 在 CAP 中的偏重

### ✅ Nacos：**CP（默认） / AP（可配置）**

#### 1️⃣ 服务发现（Naming）——偏 **CP（默认）**

- 基于 Raft 协议
- 有 Leader
- 网络分区时：
  - 少数派节点不可用
  - 保证数据强一致

👉 **不一致就拒绝服务**

#### 2️⃣ 配置管理（Config）——**强 CP**

- 配置一致性要求极高
- 不允许读到旧配置

#### 3️⃣ 可配置 AP 模式

- Nacos 支持 **临时实例（ephemeral）**
- 在某些场景下更偏 AP（类似 Eureka）

📌 一句话：

> **Nacos 默认保证一致性，必要时牺牲可用性**

------

## 四、Nacos vs Eureka 的 CAP 对比（面试核心 ⭐）

| 维度     | Eureka      | Nacos                       |
| -------- | ----------- | --------------------------- |
| CAP 取向 | **AP**      | **AP（默认） / CP（可选）** |
| 一致性   | 弱一致      | 可强一致                    |
| 网络分区 | 继续服务    | AP 模式继续 / CP 模式拒绝   |
| 自我保护 | 有          | 无（靠 Raft/TTL）           |
| 配置中心 | ❌           | ✅                           |
| 健康检查 | Client 心跳 | Client 心跳                 |

------

## 五、如何在面试中“说人话”解释差异（加分）

- **Eureka**：

  > 服务发现允许短暂不一致，只要还能调到服务即可

- **Nacos**：

  > 配置和注册信息必须一致，错了比挂了更可怕

------

nacos与eureka的区别?
当时项目就是采用的nacos作为注册中心，选择nacos还要一个重要原因就是它支持配置中心，不过nacos作为注册中心，也比eureka要方便好用一些Nacos与Eureka的共同Nacos与eureka都支持服务注册和服务拉取，都支持服务提供者心跳方式做健康检测
Nacos与Eureka的区别:

①Nacos支持服务端主动检测提供者状态:临时实例采用心跳模式非临时实例采用主动检测模式

②临时实例心跳不正常会被剔除，非临时实例则不会被剔除

③Nacos支持服务列表变更的消息推送模式，服务列表更新更及时

④Nacos集群默认采用AP方式，当集群中存在非临时实例时，采用CP模式:Eureka采用AP方式

### 建议结合业务特性，对核心配置使用CP模式，对服务发现使用AP模式。