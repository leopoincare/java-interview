## 什么是分库分表？分库分表有哪些类型（或策略）

这是数据库**高频面试题**。我按 **“是什么 → 为什么 → 有哪些类型/策略 → 面试一句话”** 给你讲清楚，结构化、好记。

------

## 面试总结一句话

> **分库分表是通过垂直拆分和水平拆分，将数据分散到多个库表中，以解决单库单表的性能和扩展瓶颈，常用策略包括取模、范围和一致性 Hash。**

## 一、什么是分库分表？

> **分库分表**：当单库单表的数据量或并发访问过大时，
>  将数据**拆分到多个数据库或多张表中**，以提升**性能、可扩展性和稳定性**。

👉 本质：**用空间换性能，用复杂度换扩展性**。

------

## 二、为什么要分库分表？

### 单库单表的问题

- 单表数据量大（千万 / 上亿）→ 查询慢
- 并发写入高 → 锁冲突严重
- 单库连接数、IO、CPU 达到瓶颈
- 容灾能力差（单点故障）

------

## 三、分库分表的两大维度

### 1️⃣ 分表 vs 分库

| 维度 | 含义                     |
| ---- | ------------------------ |
| 分表 | 同一个数据库中拆成多张表 |
| 分库 | 拆到多个数据库实例       |

👉 实际生产中常常 **分库 + 分表组合使用**

------

### 2️⃣ 垂直拆分 vs 水平拆分（重点）

------

## 四、分库分表的主要类型（策略）

### 一）垂直拆分（Vertical）

#### 1️⃣ 垂直分表

- 按 **字段** 拆分
- 把不常用、大字段单独拆表

**示例**：

```
user 表
→ user_base（id, name, phone）
→ user_detail（id, avatar, intro）
```

**特点**

- 减少单表宽度
- 提高查询效率

------

#### 2️⃣ 垂直分库

- 按 **业务模块** 拆分数据库

**示例**：

```
用户库（user_db）
订单库（order_db）
商品库（product_db）
```

**特点**

- 业务解耦
- 不同业务独立扩展

------

### 二）水平拆分（Horizontal）

#### 3️⃣ 水平分表（最常用）

- 按 **行数据** 拆分
- 表结构相同，数据不同

**示例**：

```
order_0001
order_0002
...
order_0016
```

------

#### 4️⃣ 水平分库

- 按行数据拆分到不同数据库

**示例**：

```
order_db_01.order_01
order_db_02.order_02
```

------

## 五、常见的拆分策略（分片算法）

### 1️⃣ Hash 取模（最常用）

```
user_id % 16
```

**优点**

- 数据分布均匀

**缺点**

- 扩容困难（需数据迁移）

------

### 2️⃣ 范围拆分（Range）

```
按时间 / ID 范围
```

**优点**

- 扩容简单
- 方便范围查询

**缺点**

- 容易产生热点数据

------

### 3️⃣ 一致性 Hash

- 虚拟节点 + 哈希环

**优点**

- 扩容影响小

**缺点**

- 实现复杂

------

### 4️⃣ 业务规则拆分

- 按地区 / 用户类型 / 租户

**示例**

```
华东库 / 华南库
```

------

## 六、分库分表带来的问题（面试加分）

- 跨库 JOIN 变复杂（通常禁止）
- 分布式事务难（需柔性事务）
- 分页、排序、聚合困难
- 运维复杂度高

👉 通常配合 **中间件**：

- ShardingSphere
- MyCat

------

