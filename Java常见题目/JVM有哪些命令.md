## JVMæœ‰å“ªäº›å‘½ä»¤

è¿™æ˜¯ **JVM è¿ç»´ / é¢è¯•å¿…ä¼šçš„ä¸€é¢˜**ã€‚æˆ‘ç»™ä½ æŒ‰ **â€œå¸¸ç”¨ â†’ é«˜é¢‘æ’æŸ¥ â†’ çº¿ä¸Šå®æˆ˜åœºæ™¯â€** ç³»ç»Ÿæ•´ç†ä¸€å¥— **JDK è‡ªå¸¦ JVM å‘½ä»¤å…¨é›†é€ŸæŸ¥ç‰ˆ**ï¼Œç›´æ¥èƒ½èƒŒã€èƒ½ç”¨ã€‚

------

## é¢è¯•æ€»ç»“ä¸€å¥è¯ï¼ˆå¿…èƒŒ â­ï¼‰

> **JVM æ’æŸ¥å¸¸ç”¨ jps å®šä½è¿›ç¨‹ï¼Œjstat çœ‹ GCï¼Œjmap æŸ¥å†…å­˜ï¼Œjstack æŸ¥çº¿ç¨‹ï¼Œjcmd æ˜¯æ–°ç‰ˆæœ¬çš„ç»¼åˆè¯Šæ–­å·¥å…·ã€‚**

------

## 30 ç§’èƒŒè¯µç‰ˆ

> jps æŸ¥è¿›ç¨‹ï¼Œjstat çœ‹ GCï¼Œjmap çœ‹å †ï¼Œjstack çœ‹çº¿ç¨‹ï¼Œjcmd æ˜¯å®˜æ–¹æ¨èçš„ç»Ÿä¸€è¯Šæ–­å‘½ä»¤ã€‚

## ä¸€ã€æœ€å¸¸ç”¨ JVM å‘½ä»¤ï¼ˆå¿…é¡»ä¼š â­ï¼‰

### 1ï¸âƒ£ `jps` â€”â€” æŸ¥çœ‹ Java è¿›ç¨‹

```
jps -lvm
```

- æ˜¾ç¤º Java è¿›ç¨‹ ID
- ä¸»ç±»å / jar
- JVM å‚æ•°

ğŸ“Œ **ç¬¬ä¸€æ­¥å¿…ç”¨å‘½ä»¤**

------

### 2ï¸âƒ£ `jstat` â€”â€” JVM è¿è¡ŒçŠ¶æ€

```
jstat -gc pid 1000
```

å¸¸çœ‹æŒ‡æ ‡ï¼š

| æŒ‡æ ‡  | å«ä¹‰          |
| ----- | ------------- |
| S0/S1 | Survivor      |
| E     | Eden          |
| O     | Old           |
| YGC   | Young GC æ¬¡æ•° |
| FGC   | Full GC æ¬¡æ•°  |
| GCT   | GC æ€»è€—æ—¶     |

ğŸ“Œ **çœ‹ GC æ˜¯å¦å¼‚å¸¸**

------

### 3ï¸âƒ£ `jinfo` â€”â€” JVM é…ç½®ä¿¡æ¯

```
jinfo -flags pid
jinfo -sysprops pid
```

- JVM å¯åŠ¨å‚æ•°
- ç³»ç»Ÿå±æ€§

------

### 4ï¸âƒ£ `jmap` â€”â€” å†…å­˜ & å †åˆ†æï¼ˆé‡ç‚¹ â­ï¼‰

```
jmap -heap pid
jmap -histo pid
jmap -dump:live,format=b,file=heap.hprof pid
```

ç”¨é€”ï¼š

- å †ç»“æ„
- å¯¹è±¡æ•°é‡
- å†…å­˜æ³„æ¼åˆ†æ

âš ï¸ **çº¿ä¸Šæ…ç”¨ dump**

------

### 5ï¸âƒ£ `jstack` â€”â€” çº¿ç¨‹æ ˆï¼ˆæ­»é”ç¥å™¨ â­ï¼‰

```
jstack pid
```

- æŸ¥çœ‹çº¿ç¨‹çŠ¶æ€
- æŸ¥æ­»é” / å¡é¡¿
- çœ‹ CPU é£™é«˜çº¿ç¨‹

------

## äºŒã€JVM è¾…åŠ©å·¥å…·ï¼ˆé¢è¯•åŠ åˆ†ï¼‰

### 6ï¸âƒ£ `jcmd` â€”â€” ä¸‡èƒ½å‘½ä»¤ï¼ˆæ¨è â­ï¼‰

```
jcmd pid help
jcmd pid GC.heap_info
jcmd pid GC.class_histogram
jcmd pid GC.run
```

ğŸ‘‰ æ–°ç‰ˆæœ¬ **å®˜æ–¹æ¨èæ›¿ä»£ jmap/jstack**

------

### 7ï¸âƒ£ `jconsole` â€”â€” å›¾å½¢åŒ–ç›‘æ§

```
jconsole
```

- å†…å­˜
- çº¿ç¨‹
- GC
- MBean

------

### 8ï¸âƒ£ `jvisualvm` â€”â€” æ€§èƒ½åˆ†æç¥å™¨

```
jvisualvm
```

- CPU
- å†…å­˜
- çº¿ç¨‹
- é‡‡æ · / dump åˆ†æ

------

## ä¸‰ã€æ’æŸ¥åœºæ™¯ & å¯¹åº”å‘½ä»¤ï¼ˆé¢è¯•æœ€çˆ±ï¼‰

### åœºæ™¯ 1ï¸âƒ£ï¼šCPU é£™é«˜

```
top
top -Hp pid
jstack pid
```

æµç¨‹ï¼š

1. æ‰¾é«˜ CPU çº¿ç¨‹
2. è½¬ 16 è¿›åˆ¶
3. jstack å®šä½ä»£ç 

------

### åœºæ™¯ 2ï¸âƒ£ï¼šå†…å­˜æ³„æ¼ / OOM

```
jstat -gc pid
jmap -histo pid
jmap -dump pid
```

------

### åœºæ™¯ 3ï¸âƒ£ï¼šé¢‘ç¹ Full GC

```
jstat -gc pid 1000
jinfo -flags pid
```

------

### åœºæ™¯ 4ï¸âƒ£ï¼šçº¿ç¨‹æ­»é”

```
jstack pid
```

ç›´æ¥çœ‹ï¼š

```
Found one Java-level deadlock
```

------

## å››ã€å‘½ä»¤é€ŸæŸ¥æ€»è¡¨ï¼ˆé¢è¯•ç‰ˆï¼‰

| å‘½ä»¤      | ä½œç”¨           |
| --------- | -------------- |
| jps       | æŸ¥çœ‹ Java è¿›ç¨‹ |
| jstat     | GC / å†…å­˜      |
| jinfo     | JVM å‚æ•°       |
| jmap      | å † / å¯¹è±¡      |
| jstack    | çº¿ç¨‹ / æ­»é”    |
| jcmd      | ç»¼åˆå·¥å…·       |
| jconsole  | GUI ç›‘æ§       |
| jvisualvm | æ€§èƒ½åˆ†æ       |

