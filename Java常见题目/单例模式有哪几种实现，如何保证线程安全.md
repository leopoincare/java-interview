## å•ä¾‹æ¨¡å¼æœ‰å“ªå‡ ç§å®ç°ï¼Ÿå¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ

è¿™æ˜¯ **è®¾è®¡æ¨¡å¼ + å¹¶å‘** çš„ç»å…¸é¢è¯•é¢˜ã€‚æˆ‘ç»™ä½ æŒ‰ **â€œå®ç°æ–¹å¼ â†’ çº¿ç¨‹å®‰å…¨æ€§ â†’ ä¼˜ç¼ºç‚¹ â†’ é¢è¯•æ€»ç»“â€** ä¸€æ¬¡æ€§è®²æ¸…æ¥šã€‚

------

## é¢è¯•æ€»ç»“ä¸€å¥è¯

> **å•ä¾‹æ¨¡å¼å¸¸è§å®ç°åŒ…æ‹¬é¥¿æ±‰å¼ã€æ‡’æ±‰å¼ã€åŒé‡æ£€æŸ¥é”ã€é™æ€å†…éƒ¨ç±»å’Œæšä¸¾ï¼Œå…¶ä¸­é™æ€å†…éƒ¨ç±»å’Œæšä¸¾æ–¹å¼æ—¢ä¿è¯çº¿ç¨‹å®‰å…¨åˆæ€§èƒ½æœ€å¥½ï¼Œç”Ÿäº§ä¸­æœ€æ¨èã€‚**

## ä¸€ã€å•ä¾‹æ¨¡å¼çš„å¸¸è§å®ç°æ–¹å¼

### 1ï¸âƒ£ é¥¿æ±‰å¼ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰

```
public class Singleton {
    private static final Singleton INSTANCE = new Singleton();
    private Singleton() {}
    public static Singleton getInstance() {
        return INSTANCE;
    }
}
```

**ç‰¹ç‚¹**

- ç±»åŠ è½½æ—¶åˆå§‹åŒ–
- JVM ä¿è¯çº¿ç¨‹å®‰å…¨

**ä¼˜ç¼ºç‚¹**

- âœ… çº¿ç¨‹å®‰å…¨
- âŒ å¯èƒ½æµªè´¹å†…å­˜ï¼ˆæœªä½¿ç”¨ä¹Ÿåˆ›å»ºï¼‰

------

### 2ï¸âƒ£ æ‡’æ±‰å¼ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰

```
public class Singleton {
    private static Singleton instance;
    private Singleton() {}
    public static Singleton getInstance() {
        if (instance == null) {
            instance = new Singleton();
        }
        return instance;
    }
}
```

âŒ **å¤šçº¿ç¨‹ä¸‹ä¼šåˆ›å»ºå¤šä¸ªå®ä¾‹**

------

### 3ï¸âƒ£ åŒæ­¥æ–¹æ³•æ‡’æ±‰å¼ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰

```
public class Singleton {
    private static Singleton instance;
    public static synchronized Singleton getInstance() {
        if (instance == null) {
            instance = new Singleton();
        }
        return instance;
    }
}
```

**ç¼ºç‚¹**

- æ€§èƒ½å·®ï¼ˆæ¯æ¬¡è°ƒç”¨éƒ½åŠ é”ï¼‰

------

### 4ï¸âƒ£ åŒé‡æ£€æŸ¥é”ï¼ˆDCLï¼Œæ¨èï¼‰

```
public class Singleton {
    private static volatile Singleton instance;

    public static Singleton getInstance() {
        if (instance == null) {
            synchronized (Singleton.class) {
                if (instance == null) {
                    instance = new Singleton();
                }
            }
        }
        return instance;
    }
}
```

**å…³é”®ç‚¹**

- `volatile` é˜²æ­¢æŒ‡ä»¤é‡æ’
- åŒé‡ `null` åˆ¤æ–­å‡å°‘é”ç«äº‰

------

### 5ï¸âƒ£ é™æ€å†…éƒ¨ç±»ï¼ˆæ¨è â­ï¼‰

```
public class Singleton {
    private Singleton() {}
    private static class Holder {
        private static final Singleton INSTANCE = new Singleton();
    }
    public static Singleton getInstance() {
        return Holder.INSTANCE;
    }
}
```

**ä¼˜ç‚¹**

- æ‡’åŠ è½½
- JVM ç±»åŠ è½½ä¿è¯çº¿ç¨‹å®‰å…¨
- æ€§èƒ½å¥½

------

### 6ï¸âƒ£ æšä¸¾å•ä¾‹ï¼ˆæœ€å®‰å…¨ â­â­â­ï¼‰

```
public enum Singleton {
    INSTANCE;
}
```

**ä¼˜ç‚¹**

- å¤©ç„¶çº¿ç¨‹å®‰å…¨
- é˜²æ­¢åå°„å’Œååºåˆ—åŒ–ç ´åå•ä¾‹

------

## äºŒã€å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿï¼ˆé¢è¯•é‡ç‚¹ï¼‰

### 1ï¸âƒ£ JVM ç±»åŠ è½½æœºåˆ¶

- é¥¿æ±‰å¼ / é™æ€å†…éƒ¨ç±» / æšä¸¾
- **ç±»åŠ è½½é˜¶æ®µæ˜¯çº¿ç¨‹å®‰å…¨çš„**

------

### 2ï¸âƒ£ synchronized

- åŒæ­¥æ–¹æ³• / åŒæ­¥ä»£ç å—
- ä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹åˆ›å»ºå®ä¾‹

------

### 3ï¸âƒ£ volatileï¼ˆDCL å¿…é¡»ï¼‰

- é˜²æ­¢æŒ‡ä»¤é‡æ’
- ä¿è¯å®ä¾‹åˆå§‹åŒ–å®Œæˆåæ‰å¯¹å…¶ä»–çº¿ç¨‹å¯è§

------

## ä¸‰ã€åå°„å’Œåºåˆ—åŒ–ç ´åå•ä¾‹ï¼Ÿ

### åå°„

```
constructor.setAccessible(true);
```

- å¯åˆ›å»ºå¤šä¸ªå®ä¾‹
- è§£å†³ï¼šæ„é€ æ–¹æ³•ä¸­åˆ¤æ–­å®ä¾‹æ˜¯å¦å­˜åœ¨

### åºåˆ—åŒ–

- `readObject()` ä¼šåˆ›å»ºæ–°å¯¹è±¡
- è§£å†³ï¼šå®ç° `readResolve()`

ğŸ‘‰ **æšä¸¾å•ä¾‹å¤©ç„¶è§£å†³ä»¥ä¸Šé—®é¢˜**

------

## å››ã€å¸¸è§é¢è¯•å¯¹æ¯”æ€»ç»“

| å®ç°æ–¹å¼   | çº¿ç¨‹å®‰å…¨ | æ‡’åŠ è½½ | æ¨èæŒ‡æ•° |
| ---------- | -------- | ------ | -------- |
| é¥¿æ±‰å¼     | âœ…        | âŒ      | â­â­       |
| æ‡’æ±‰å¼     | âŒ        | âœ…      | âŒ        |
| åŒæ­¥æ–¹æ³•   | âœ…        | âœ…      | â­        |
| DCL        | âœ…        | âœ…      | â­â­â­      |
| é™æ€å†…éƒ¨ç±» | âœ…        | âœ…      | â­â­â­â­     |
| æšä¸¾       | âœ…        | âŒ      | â­â­â­â­â­    |

