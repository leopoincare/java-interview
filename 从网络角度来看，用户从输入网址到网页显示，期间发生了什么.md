## 从网络角度来看，用户从输入网址到网页显示，期间发生了什么

这是**后端 / 网络 / 系统设计**必考的综合题，面试官看的是你对 **网络协议栈 + 浏览器机制 + 服务端架构** 的整体认知。下面给你一套**结构化、可逐层展开**的答案。

------

## 面试总结一句话

> **从输入 URL 到页面显示，经历了 DNS 解析、TCP/TLS 建连、HTTP 请求响应、网络转发和浏览器解析渲染多个阶段，每一步都可能成为性能瓶颈。**

------

## 一、先给「一口气版本」（面试 30 秒版 ⭐）

> **用户输入 URL 后，浏览器先做 DNS 解析获取 IP，通过 TCP 三次握手（HTTPS 还包括 TLS 握手）建立连接，发送 HTTP 请求，服务端处理并返回响应，浏览器解析 HTML 构建 DOM/CSSOM，执行 JS，最终渲染页面。**

------

## 二、详细过程（网络角度为主）

### 1️⃣ URL 解析

浏览器解析：

- 协议（HTTP / HTTPS）
- 域名
- 端口
- 路径 / 参数

------

### 2️⃣ DNS 解析（域名 → IP）

查询顺序：

1. 浏览器缓存
2. OS 缓存
3. 本地域名服务器
4. 根 → 顶级 → 权威 DNS

📌 结果：

- 获得服务端 IP 地址

------

### 3️⃣ 建立连接

#### HTTP

- TCP 三次握手

#### HTTPS（重点）

- TCP 三次握手
- **TLS 握手**：
  - 证书校验
  - 协商加密算法
  - 生成对称密钥

------

### 4️⃣ 发送 HTTP 请求

- 请求行：`GET /index.html HTTP/1.1`
- 请求头：Cookie、User-Agent、Accept
- 请求体（POST）

------

### 5️⃣ 网络转发过程（可能经过）

- 本地网卡
- 路由器 / 交换机
- NAT
- 防火墙
- CDN
- 负载均衡

------

### 6️⃣ 服务端处理请求

- Web Server（Nginx）
- 应用服务（Java / Go）
- 业务逻辑
- 数据库 / 缓存
- 生成响应

------

### 7️⃣ 返回 HTTP 响应

- 状态码（200 / 304 / 404）
- 响应头（Cache-Control）
- 响应体（HTML / JSON）

------

### 8️⃣ 浏览器渲染页面（关键）

#### 渲染流程：

1. 解析 HTML → DOM
2. 解析 CSS → CSSOM
3. DOM + CSSOM → Render Tree
4. Layout（布局）
5. Paint（绘制）
6. Composite（合成）

📌 JS 执行可能阻塞渲染

------

## 三、关键优化点（面试加分 ⭐）

### 网络层

- DNS 预解析
- HTTP/2 多路复用
- CDN
- TCP 连接复用

### 浏览器层

- 资源懒加载
- 减少重排重绘
- JS/CSS 合理加载

### 服务端

- 缓存（Redis / HTTP Cache）
- 压缩（Gzip / Brotli）
- 异步处理

------

## 四、面试官常追问（你已经具备基础）

- ❓ DNS 用的是 TCP 还是 UDP？
- ❓ HTTPS 为什么比 HTTP 慢？
- ❓ TCP 慢启动在哪一步？
- ❓ HTTP/2 是怎么提升性能的？
- ❓ 浏览器为什么要分域名请求资源？

------

## 1️⃣ DNS 用的是 TCP 还是 UDP？

### 结论

> **DNS 默认使用 UDP，必要时使用 TCP**

### 什么时候用 UDP？

- 查询体积小（< 512B，EDNS 后可更大）
- 单次请求响应
- 快速、无连接

### 什么时候用 TCP？

- 返回结果过大（如很多 A 记录）
- DNS 区域传送（AXFR）
- UDP 被截断（TC 标志位）

### 面试一句话

> **DNS 查询默认走 UDP，提高效率，结果过大或可靠性要求高时切换到 TCP。**

------

## 2️⃣ HTTPS 为什么比 HTTP 慢？

### 本质原因

> **多了 TLS 握手和加解密成本**

### 慢在哪？

1. **TLS 握手**
   - 证书校验
   - 密钥协商（非对称加密）
   - 多 1~2 个 RTT
2. **加解密开销**
   - 数据传输前后加解密

------

### 为什么现在差距不明显？

- TLS 1.3（握手减少）
- Session Resumption
- HTTP/2 多路复用
- 硬件加速

### 面试一句话

> **HTTPS 因 TLS 握手和加解密带来额外开销，但现代协议和硬件已大幅降低影响。**

------

## 3️⃣ TCP 慢启动在哪一步？

### 发生阶段

> **TCP 连接建立后、数据传输初期**

### 具体过程

- 初始拥塞窗口（cwnd）很小
- 每 RTT 翻倍增长
- 直到达到阈值或出现丢包

📌 三次握手期间 **不传输数据**

------

### 面试一句话

> **TCP 慢启动发生在连接建立后的初始数据发送阶段，用于探测网络可用带宽。**

------

## 4️⃣ HTTP/2 是怎么提升性能的？

### 核心机制（必背 ⭐）

1️⃣ **多路复用**

- 一个 TCP 连接
- 多个请求并行
- 无队头阻塞（应用层）

2️⃣ **头部压缩（HPACK）**

- 减少重复 Header 体积

3️⃣ **二进制分帧**

- 更高效解析

4️⃣ **服务器推送**

- 主动发送资源（现在用得少）

------

### 面试一句话

> **HTTP/2 通过多路复用、头部压缩和二进制分帧，在单连接上并发传输请求，大幅降低延迟。**

------

## 5️⃣ 浏览器为什么要分域名请求资源？

### 结论

> **为了突破浏览器的单域名并发连接数限制**

### 原因

- HTTP/1.1：
  - 每个域名并发连接数有限（通常 6）
- 静态资源多 → 排队等待

### 解决方式

- 多个域名（cdn1 / cdn2）
- 并发下载资源

📌 HTTP/2 时代：

- 单连接多路复用
- 分域名反而可能降低性能

------

### 面试一句话

> **分域名是为绕过 HTTP/1.1 的并发限制，而在 HTTP/2 下已不再推荐。**

------

## 🧠 五问速记总结（30 秒）

> - DNS 默认 UDP，必要时 TCP
> - HTTPS 慢在 TLS 握手和加密
> - TCP 慢启动在建连后的初期传输
> - HTTP/2 用多路复用提升并发
> - 分域名是为突破 HTTP/1.1 并发限制

## HTTPS 网站加载

### 4️⃣ TLS 握手（HTTPS 核心 ⭐）

> **HTTPS = HTTP + TLS**

### TLS 1.2（经典面试版）

1. **ClientHello**
   - 支持的 TLS 版本
   - 加密套件
   - 随机数
2. **ServerHello**
   - 选择加密套件
   - 返回服务器证书
   - 随机数
3. **证书校验**
   - CA 验证
   - 域名匹配
   - 证书有效期
4. **密钥协商**
   - 使用非对称加密生成 Pre-Master Secret
   - 双方计算对称密钥
5. **Finished**
   - 握手完成

📌 握手后 **用对称加密传输数据**

------

### TLS 1.3（加分）

- 握手减少为 **1 RTT**
- 移除 RSA
- 更快、更安全

## 对比 TLS1.2 vs TLS1.3

### 一、核心对比表（面试快速记忆版 ⭐）

| 维度         | TLS 1.2                      | TLS 1.3                           | 面试关键点                            |
| ------------ | ---------------------------- | --------------------------------- | ------------------------------------- |
| 握手 RTT     | 2 RTT                        | 1 RTT                             | TLS 1.3 减少握手延迟                  |
| 非对称加密   | RSA 或 ECDHE                 | ECDHE（不支持 RSA key exchange）  | TLS 1.3 弃用不安全的 RSA key exchange |
| 密钥生成     | 客户端生成 Pre-Master Secret | 服务端和客户端通过 ECDHE 直接生成 | 更安全                                |
| 加密算法协商 | 多轮协商                     | 一次协商                          | 简化握手                              |
| 零轮次恢复   | ❌                            | ✔（0-RTT）                        | 支持快速重连                          |
| 加密范围     | 握手未加密                   | 整个握手几乎都加密                | TLS 1.3 防止中间人窃听握手信息        |
| 删除算法     | 支持 RC4、MD5、SHA1          | 移除不安全算法                    | 安全性更高                            |

------

### 二、TLS1.2 vs TLS1.3 面试答法模板

### 问法：TLS1.2 和 TLS1.3 有什么区别？

**回答示例：**

> **TLS 1.3 相比 TLS 1.2，握手从 2 RTT 减少到 1 RTT，同时整个握手过程几乎全程加密，弃用了不安全的 RSA key exchange 和旧算法，支持 0-RTT 快速恢复。总的来说，TLS1.3 更快、更安全、更简洁。**

------

### 面试加分点

1. **握手次数**
   - TLS1.2：客户端→服务端 2 RTT
   - TLS1.3：1 RTT（握手更快）
2. **加密安全**
   - TLS1.3 移除 RC4、MD5、SHA1、RSA key exchange
3. **性能优化**
   - 0-RTT 复用密钥，减少重连延迟
4. **隐私保护**
   - 握手早期信息加密，防止中间人嗅探

------

### 三、面试总结一句话

> **TLS1.3 相比 TLS1.2 更安全、更快、握手更简洁，并支持 0-RTT 快速恢复，是 HTTPS 的推荐版本。**